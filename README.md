# Практическая работа № 5
Студент: Юркин В.И.

Группа: ПИМО-01-25

Тема: Подключение к PostgreSQL через database/sql. Выполнение простых запросов (INSERT, SELECT)

Цели:
- Установить и настроить PostgreSQL.
- Подключиться к БД из Go с помощью database/sql и драйвера PostgreSQL.
- Выполнить параметризованные запросы INSERT и SELECT.
- Корректно работать с context, пулом соединений и обработкой ошибок

## Окружение
- Сервер: go 1.23.0 (Windows)
- БД: PostgreSQL 16.10 (Ubuntu 16.10-0ubuntu0.24.04.1)

## Скриншоты
Создание таблицы в psql

![alt text](docs/image.png)

Успешный вывод go run .

![alt text](docs/image-1.png)

SELECT * FROM tasks;

![alt text](docs/image-2.png)

## Ответы на вопросы

1. Пул соединений *sql.DB и зачем его настраивать:
- *sql.DB управляет множеством соединений с БД.
- Настройка SetMaxOpenConns, SetMaxIdleConns, SetConnMaxLifetime позволяет:
    - ограничить количество одновременных соединений,
    - уменьшить накладные расходы на открытие/закрытие,
    - повысить производительность.
2. Почему используем плейсхолдеры $1, $2:
- Предотвращают SQL-инъекции,
- Автоматически экранируют значения,
- Облегчают работу с динамическими данными.

3. Чем отличаются Query, QueryRow и Exec:

|Метод	|Возвращает	|Используется для|
|-------|-----------|----------------|
|Exec	|Результат выполнения|	INSERT, UPDATE, DELETE|
|QueryRow|	Одна строка	|SELECT одного объекта|
|Query|	Несколько строк|	SELECT множества объектов|

## Обоснование транзакций и настроек пула
- Транзакции нужны для массовой вставки (CreateMany) — чтобы либо все строки добавились, либо ни одной при ошибке.

- Настройки пула (SetMaxOpenConns=10, SetMaxIdleConns=5, SetConnMaxLifetime=30min) выбраны для локальной машины:
    - Достаточно для небольшого учебного проекта,
    - Снижают накладные расходы,
    - Избегают лишнего открытия/закрытия соединений.

## Установка
Установка зависимостей
```bash
go mod tidy
```

### Отладка
Запуск проекта в режиме разработки
```bash
make run
```

### Билд
Билд проекта
```bash
make build
```
Запуск билда
```bash
.\pz5-db
```

## Конфигурация
Переменные окружения:
- DATABASE_URL - строка подключения к базе данных (обязательный, пример postgres://user:password@localhost:5432/todo?sslmode=disable)


